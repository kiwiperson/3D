var THREEx=THREEx||{};(function(){var e=function(e,t){t=t||"image/png";var n=e.domElement.toDataURL(t);return n},t=function(e,t,n,r){var i=function(e,t,n,r){var i=r/n;return n>=e&&i<=1?(n=e,r=e*i):r>=t&&(r=t,n=t/i),{width:n,height:r}},s=function(){var e=document.createElement("canvas");e.width=t,e.height=n;var s=e.getContext("2d"),u=i(e.width,e.height,o.width,o.height),a=(e.width-u.width)/2,f=(e.height-u.height)/2;s.drawImage(o,a,f,u.width,u.height);var l="image/png",c=e.toDataURL(l);r&&r(c)}.bind(this),o=new Image;o.onload=s,o.src=e},n=function(e,n){n=n||{};var r=n.charCode||"p".charCodeAt(0),i=n.width||400,s=n.height||300,o=n.callback||function(e){window.open(e,"name-"+Math.random())},u=function(n){var r=document.getElementById("pictureTaking");if(n.target!==r)return;var u=this.toDataURL(e);i===undefined&&s===undefined?o(u):t(u,i,s,o)}.bind(this),a=function(n){if(n.which!==r)return;mimetype="image/png";var u=e.domElement.toDataURL(mimetype);i===undefined&&s===undefined?o(u):t(u,i,s,o)}.bind(this);return document.addEventListener("keypress",a,!1),document.addEventListener("click",u,!1),{unbind:function(){document.removeEventListener("keypress",a,!1)}}};THREEx.Screenshot={toDataURL:e,bindKey:n}})();