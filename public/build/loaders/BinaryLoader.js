THREE.BinaryLoader=function(e){THREE.Loader.call(this,e)},THREE.BinaryLoader.prototype=Object.create(THREE.Loader.prototype),THREE.BinaryLoader.prototype.load=function(e,t,n,r){n=n&&typeof n=="string"?n:this.extractUrlBase(e),r=r&&typeof r=="string"?r:this.extractUrlBase(e);var i=this.showProgress?THREE.Loader.prototype.updateProgress:null;this.onLoadStart(),this.loadAjaxJSON(this,e,t,n,r,i)},THREE.BinaryLoader.prototype.loadAjaxJSON=function(e,t,n,r,i,s){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState==4)if(o.status==200||o.status==0){var u=JSON.parse(o.responseText);e.loadAjaxBuffers(u,n,i,r,s)}else console.error("THREE.BinaryLoader: Couldn't load ["+t+"] ["+o.status+"]")},o.open("GET",t,!0),o.send(null)},THREE.BinaryLoader.prototype.loadAjaxBuffers=function(e,t,n,r,i){var s=new XMLHttpRequest,o=n+"/"+e.buffers,u=0;s.onreadystatechange=function(){if(s.readyState==4)if(s.status==200||s.status==0){var n=s.response;n===undefined&&(n=(new Uint8Array(s.responseBody)).buffer),THREE.BinaryLoader.prototype.createBinModel(n,t,r,e.materials)}else console.error("THREE.BinaryLoader: Couldn't load ["+o+"] ["+s.status+"]");else s.readyState==3?i&&(u==0&&(u=s.getResponseHeader("Content-Length")),i({total:u,loaded:s.responseText.length})):s.readyState==2&&(u=s.getResponseHeader("Content-Length"))},s.open("GET",o,!0),s.responseType="arraybuffer",s.send(null)},THREE.BinaryLoader.prototype.createBinModel=function(e,t,n,r){function s(e,t,n,r){e.vertices.push(new THREE.Vector3(t,n,r))}function o(e,t,n,r,i){e.faces.push(new THREE.Face3(t,n,r,null,null,i))}function u(e,t,n,r,i,s){e.faces.push(new THREE.Face4(t,n,r,i,null,null,s))}function a(e,t,n,r,i,s,o,u,a){var f=t[o*3],l=t[o*3+1],c=t[o*3+2],h=t[u*3],p=t[u*3+1],d=t[u*3+2],v=t[a*3],m=t[a*3+1],g=t[a*3+2];e.faces.push(new THREE.Face3(n,r,i,[new THREE.Vector3(f,l,c),new THREE.Vector3(h,p,d),new THREE.Vector3(v,m,g)],null,s))}function f(e,t,n,r,i,s,o,u,a,f,l){var c=t[u*3],h=t[u*3+1],p=t[u*3+2],d=t[a*3],v=t[a*3+1],m=t[a*3+2],g=t[f*3],y=t[f*3+1],b=t[f*3+2],w=t[l*3],E=t[l*3+1],S=t[l*3+2];e.faces.push(new THREE.Face4(n,r,i,s,[new THREE.Vector3(c,h,p),new THREE.Vector3(d,v,m),new THREE.Vector3(g,y,b),new THREE.Vector3(w,E,S)],null,o))}function l(e,t,n,r,i,s,o){e.push([new THREE.Vector2(t,n),new THREE.Vector2(r,i),new THREE.Vector2(s,o)])}function c(e,t,n,r,i,s,o,u,a){e.push([new THREE.Vector2(t,n),new THREE.Vector2(r,i),new THREE.Vector2(s,o),new THREE.Vector2(u,a)])}var i=function(t){function _(e){return e%4?4-e%4:0}function D(e,t){var n={signature:P(e,t,12),header_bytes:H(e,t+12),vertex_coordinate_bytes:H(e,t+13),normal_coordinate_bytes:H(e,t+14),uv_coordinate_bytes:H(e,t+15),vertex_index_bytes:H(e,t+16),normal_index_bytes:H(e,t+17),uv_index_bytes:H(e,t+18),material_index_bytes:H(e,t+19),nvertices:B(e,t+20),nnormals:B(e,t+20+4),nuvs:B(e,t+20+8),ntri_flat:B(e,t+20+12),ntri_smooth:B(e,t+20+16),ntri_flat_uv:B(e,t+20+20),ntri_smooth_uv:B(e,t+20+24),nquad_flat:B(e,t+20+28),nquad_smooth:B(e,t+20+32),nquad_flat_uv:B(e,t+20+36),nquad_smooth_uv:B(e,t+20+40)};return n}function P(e,t,n){var r=new Uint8Array(e,t,n),i="";for(var s=0;s<n;s++)i+=String.fromCharCode(r[t+s]);return i}function H(e,t){var n=new Uint8Array(e,t,1);return n[0]}function B(e,t){var n=new Uint32Array(e,t,1);return n[0]}function j(t){var r=i.nvertices,o=new Float32Array(e,t,r*3),u,a,f,l;for(u=0;u<r;u++)a=o[u*3],f=o[u*3+1],l=o[u*3+2],s(n,a,f,l);return r*3*Float32Array.BYTES_PER_ELEMENT}function F(t){var n=i.nnormals;if(n){var r=new Int8Array(e,t,n*3),s,o,u,a;for(s=0;s<n;s++)o=r[s*3],u=r[s*3+1],a=r[s*3+2],h.push(o/127,u/127,a/127)}return n*3*Int8Array.BYTES_PER_ELEMENT}function I(t){var n=i.nuvs;if(n){var r=new Float32Array(e,t,n*2),s,o,u;for(s=0;s<n;s++)o=r[s*2],u=r[s*2+1],p.push(o,u)}return n*2*Float32Array.BYTES_PER_ELEMENT}function q(t,r){var i,s,o,u,a,f,c,h,d,v,m=new Uint32Array(e,r,3*t);for(i=0;i<t;i++)s=m[i*3],o=m[i*3+1],u=m[i*3+2],a=p[s*2],h=p[s*2+1],f=p[o*2],d=p[o*2+1],c=p[u*2],v=p[u*2+1],l(n.faceVertexUvs[0],a,h,f,d,c,v)}function R(t,r){var i,s,o,u,a,f,l,h,d,v,m,g,y,b=new Uint32Array(e,r,4*t);for(i=0;i<t;i++)s=b[i*4],o=b[i*4+1],u=b[i*4+2],a=b[i*4+3],f=p[s*2],v=p[s*2+1],l=p[o*2],m=p[o*2+1],h=p[u*2],g=p[u*2+1],d=p[a*2],y=p[a*2+1],c(n.faceVertexUvs[0],f,v,l,m,h,g,d,y)}function U(t,r,i){var s,u,a,f,l,c=new Uint32Array(e,r,3*t),h=new Uint16Array(e,i,t);for(s=0;s<t;s++)u=c[s*3],a=c[s*3+1],f=c[s*3+2],l=h[s],o(n,u,a,f,l)}function z(t,r,i){var s,o,a,f,l,c,h=new Uint32Array(e,r,4*t),p=new Uint16Array(e,i,t);for(s=0;s<t;s++)o=h[s*4],a=h[s*4+1],f=h[s*4+2],l=h[s*4+3],c=p[s],u(n,o,a,f,l,c)}function W(t,r,i,s){var o,u,f,l,c,p,d,v,m=new Uint32Array(e,r,3*t),g=new Uint32Array(e,i,3*t),y=new Uint16Array(e,s,t);for(o=0;o<t;o++)u=m[o*3],f=m[o*3+1],l=m[o*3+2],p=g[o*3],d=g[o*3+1],v=g[o*3+2],c=y[o],a(n,h,u,f,l,c,p,d,v)}function X(t,r,i,s){var o,u,a,l,c,p,d,v,m,g,y=new Uint32Array(e,r,4*t),b=new Uint32Array(e,i,4*t),w=new Uint16Array(e,s,t);for(o=0;o<t;o++)u=y[o*4],a=y[o*4+1],l=y[o*4+2],c=y[o*4+3],d=b[o*4],v=b[o*4+1],m=b[o*4+2],g=b[o*4+3],p=w[o],f(n,h,u,a,l,c,p,d,v,m,g)}function V(e){var t=i.ntri_flat;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*3;U(t,e,n)}}function $(e){var t=i.ntri_flat_uv;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*3,r=n+t*Uint32Array.BYTES_PER_ELEMENT*3;U(t,e,r),q(t,n)}}function J(e){var t=i.ntri_smooth;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*3,r=n+t*Uint32Array.BYTES_PER_ELEMENT*3;W(t,e,n,r)}}function K(e){var t=i.ntri_smooth_uv;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*3,r=n+t*Uint32Array.BYTES_PER_ELEMENT*3,s=r+t*Uint32Array.BYTES_PER_ELEMENT*3;W(t,e,n,s),q(t,r)}}function Q(e){var t=i.nquad_flat;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*4;z(t,e,n)}}function G(e){var t=i.nquad_flat_uv;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*4,r=n+t*Uint32Array.BYTES_PER_ELEMENT*4;z(t,e,r),R(t,n)}}function Y(e){var t=i.nquad_smooth;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*4,r=n+t*Uint32Array.BYTES_PER_ELEMENT*4;X(t,e,n,r)}}function Z(e){var t=i.nquad_smooth_uv;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*4,r=n+t*Uint32Array.BYTES_PER_ELEMENT*4,s=r+t*Uint32Array.BYTES_PER_ELEMENT*4;X(t,e,n,s),R(t,r)}}var n=this,r=0,i,h=[],p=[],d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;THREE.Geometry.call(this),i=D(e,r),r+=i.header_bytes,S=i.vertex_index_bytes*3+i.material_index_bytes,x=i.vertex_index_bytes*4+i.material_index_bytes,T=i.ntri_flat*S,N=i.ntri_smooth*(S+i.normal_index_bytes*3),C=i.ntri_flat_uv*(S+i.uv_index_bytes*3),k=i.ntri_smooth_uv*(S+i.normal_index_bytes*3+i.uv_index_bytes*3),L=i.nquad_flat*x,A=i.nquad_smooth*(x+i.normal_index_bytes*4),O=i.nquad_flat_uv*(x+i.uv_index_bytes*4),M=i.nquad_smooth_uv*(x+i.normal_index_bytes*4+i.uv_index_bytes*4),r+=j(r),r+=F(r),r+=_(i.nnormals*3),r+=I(r),d=r,v=d+T+_(i.ntri_flat*2),m=v+N+_(i.ntri_smooth*2),g=m+C+_(i.ntri_flat_uv*2),y=g+k+_(i.ntri_smooth_uv*2),b=y+L+_(i.nquad_flat*2),w=b+A+_(i.nquad_smooth*2),E=w+O+_(i.nquad_flat_uv*2),$(m),K(g),G(w),Z(E),V(d),J(v),Q(y),Y(b),this.computeCentroids(),this.computeFaceNormals()};i.prototype=Object.create(THREE.Geometry.prototype);var h=new i(n),p=this.initMaterials(r,n);this.needsTangents(p)&&h.computeTangents(),t(h,p)};