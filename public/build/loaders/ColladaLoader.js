THREE.ColladaLoader=function(){function x(e,t,n){var i=0;if(document.implementation&&document.implementation.createDocument){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(s.readyState==4){if(s.status==0||s.status==200)if(s.responseXML)r=t,T(s.responseXML,undefined,e);else if(s.responseText){r=t;var o=new DOMParser,u=o.parseFromString(s.responseText,"application/xml");T(u,undefined,e)}else console.error("ColladaLoader: Empty or non-existing file ("+e+")")}else s.readyState==3&&n&&(i==0&&(i=s.getResponseHeader("Content-Length")),n({total:i,loaded:s.responseText.length}))},s.open("GET",e,!0),s.send(null)}else alert("Don't know how to parse XML!")}function T(i,g,y){e=i,g=g||r;if(y!==undefined){var b=y.split("/");b.pop(),d=(b.length<1?".":b.join("/"))+"/"}C(),qt(),s=k("//dae:library_images/dae:image",K,"image"),f=k("//dae:library_materials/dae:material",dt,"material"),l=k("//dae:library_effects/dae:effect",bt,"effect"),a=k("//dae:library_geometries/dae:geometry",st,"geometry"),c=k(".//dae:library_cameras/dae:camera",Nt,"camera"),u=k("//dae:library_controllers/dae:controller",Q,"controller"),o=k("//dae:library_animations/dae:animation",Et,"animation"),p=k(".//dae:library_visual_scenes/dae:visual_scene",Z,"visual_scene"),v=[],m=[],n=L(),t=new THREE.Object3D;for(var E=0;E<n.nodes.length;E++)t.add(j(n.nodes[E]));t.scale.multiplyScalar(w),A();var S={scene:t,morphs:v,skins:m,animations:h,dae:{images:s,materials:f,cameras:c,effects:l,geometries:a,controllers:u,animations:o,visualScenes:p,scene:n}};return g&&g(S),S}function N(e){y=e}function C(){var t=e.evaluate("//dae:asset",e,Lt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),n=t.iterateNext();if(n&&n.childNodes)for(var r=0;r<n.childNodes.length;r++){var i=n.childNodes[r];switch(i.nodeName){case"unit":var s=i.getAttribute("meter");s&&(w=parseFloat(s));break;case"up_axis":E=i.textContent.charAt(0)}}}function k(t,n,r){var i=e.evaluate(t,e,Lt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),s={},o=i.iterateNext(),u=0;while(o){var a=(new n).parse(o);if(!a.id||a.id.length==0)a.id=r+u++;s[a.id]=a,o=i.iterateNext()}return s}function L(){var t=e.evaluate(".//dae:scene/dae:instance_visual_scene",e,Lt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext();if(t){var n=t.getAttribute("url").replace(/^#/,"");return p[n.length>0?n:"visual_scene0"]}return null}function A(){h=[],O(t)}function O(e){var t=n.getChildById(e.name,!0),r=null;if(t&&t.keys){r={fps:60,hierarchy:[{node:t,keys:t.keys,sids:t.sids}],node:e,name:"animation_"+e.name,length:0},h.push(r);for(var i=0,s=t.keys.length;i<s;i++)r.length=Math.max(r.length,t.keys[i].time)}else r={hierarchy:[{keys:[],sids:[]}]};for(var i=0,s=e.children.length;i<s;i++){var o=O(e.children[i]);for(var u=0,a=o.hierarchy.length;u<a;u++)r.hierarchy.push({keys:[],sids:[]})}return r}function M(){var e=1e6,t=-e,n=0;for(var r in o){var i=o[r];for(var s=0;s<i.sampler.length;s++){var u=i.sampler[s];u.create(),e=Math.min(e,u.startTime),t=Math.max(t,u.endTime),n=Math.max(n,u.input.length)}}return{start:e,end:t,frames:n}}function _(e,t){var n=t instanceof nt?u[t.url]:t;if(!n||!n.morph){console.log("could not find morph controller!");return}var r=n.morph;for(var i=0;i<r.targets.length;i++){var s=r.targets[i],o=a[s];if(!o.mesh||!o.mesh.primitives||!o.mesh.primitives.length)continue;var f=o.mesh.primitives[0].geometry;f.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:f.vertices})}e.morphTargets.push({name:"target_Z",vertices:e.vertices})}function D(e,t,r){var i=u[t.url];if(!i||!i.skin){console.log("could not find skin controller!");return}if(!t.skeleton||!t.skeleton.length){console.log("could not find the skeleton for the skin!");return}var s=i.skin,o=n.getChildById(t.skeleton[0]),a=[];r=r!==undefined?r:!0;var f=[];e.skinWeights=[],e.skinIndices=[];if(r)for(var l=0;l<e.vertices.length;l++)e.vertices[l].applyMatrix4(s.bindShapeMatrix)}function P(e,t,n,r){e.world=e.world||new THREE.Matrix4,e.world.copy(e.matrix);if(e.channels&&e.channels.length){var i=e.channels[0],s=i.sampler.output[n];s instanceof THREE.Matrix4&&e.world.copy(s)}r&&e.world.multiplyMatrices(r,e.world),t.push(e);for(var o=0;o<e.nodes.length;o++)P(e.nodes[o],t,n,e.world)}function H(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=-1;if(r.type!="JOINT")continue;for(var s=0;s<t.joints.length;s++)if(r.sid==t.joints[s]){i=s;break}if(!(i>=0))throw"ColladaLoader: Could not find joint '"+r.sid+"'.";var o=t.invBindMatrices[i];r.invBindMatrix=o,r.skinningMatrix=new THREE.Matrix4,r.skinningMatrix.multiplyMatrices(r.world,o),r.weights=[];for(var s=0;s<t.weights.length;s++)for(var u=0;u<t.weights[s].length;u++){var a=t.weights[s][u];a.joint==i&&r.weights.push(a)}}}function B(e,t,r){var i=u[t.url];r=r!==undefined?r:40;if(!i||!i.skin){console.log("ColladaLoader: Could not find skin controller.");return}if(!t.skeleton||!t.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ");return}var s=M(),o=n.getChildById(t.skeleton[0],!0)||n.getChildBySid(t.skeleton[0],!0),a,f,l,c,h,p=new THREE.Vector3,d,v;for(a=0;a<e.vertices.length;a++)e.vertices[a].applyMatrix4(i.skin.bindShapeMatrix);for(r=0;r<s.frames;r++){var m=[],g=[];for(a=0;a<e.vertices.length;a++)g.push(new THREE.Vector3);P(o,m,r),H(m,i.skin);for(a=0;a<m.length;a++){if(m[a].type!="JOINT")continue;for(f=0;f<m[a].weights.length;f++)l=m[a].weights[f],c=l.index,h=l.weight,d=e.vertices[c],v=g[c],p.x=d.x,p.y=d.y,p.z=d.z,p.applyMatrix4(m[a].skinningMatrix),v.x+=p.x*h,v.y+=p.y*h,v.z+=p.z*h}e.morphTargets.push({name:"target_"+r,vertices:g})}}function j(e,t){var n=new THREE.Object3D,r=!1,i,s,o,h;for(o=0;o<e.controllers.length;o++){var p=u[e.controllers[o].url];switch(p.type){case"skin":if(a[p.skin.source]){var d=new it;d.url=p.skin.source,d.instance_material=e.controllers[o].instance_material,e.geometries.push(d),r=!0,i=e.controllers[o]}else if(u[p.skin.source]){var g=u[p.skin.source];s=g;if(g.morph&&a[g.morph.source]){var d=new it;d.url=g.morph.source,d.instance_material=e.controllers[o].instance_material,e.geometries.push(d)}}break;case"morph":if(a[p.morph.source]){var d=new it;d.url=p.morph.source,d.instance_material=e.controllers[o].instance_material,e.geometries.push(d),s=e.controllers[o]}console.log("ColladaLoader: Morph-controller partially supported.");default:}}var y={};for(o=0;o<e.geometries.length;o++){var w=e.geometries[o],E=w.instance_material,S=a[w.url],x={},T=[],N=0,C;if(S){if(!S.mesh||!S.mesh.primitives)continue;n.name.length==0&&(n.name=S.id);if(E)for(h=0;h<E.length;h++){var k=E[h],L=f[k.target],A=L.instance_effect.url,O=l[A].shader,M=O.material;if(S.doubleSided){if(!(M in y)){var D=M.clone();D.side=THREE.DoubleSide,y[M]=D}M=y[M]}M.opacity=M.opacity?M.opacity:1,x[k.symbol]=N,T.push(M),C=M,C.name=L.name==null||L.name===""?L.id:L.name,N++}var P,H=C||new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading,side:S.doubleSided?THREE.DoubleSide:THREE.FrontSide}),F=S.mesh.geometry3js;if(N>1){H=new THREE.MeshFaceMaterial(T);for(h=0;h<F.faces.length;h++){var I=F.faces[h];I.materialIndex=x[I.daeMaterial]}}i!==undefined?(B(F,i),H.morphTargets=!0,P=new THREE.SkinnedMesh(F,H,!1),P.skeleton=i.skeleton,P.skinController=u[i.url],P.skinInstanceController=i,P.name="skin_"+m.length,m.push(P)):s!==undefined?(_(F,s),H.morphTargets=!0,P=new THREE.Mesh(F,H),P.name="morph_"+v.length,v.push(P)):P=new THREE.Mesh(F,H),e.geometries.length>1?n.add(P):n=P}}for(o=0;o<e.cameras.length;o++){var q=e.cameras[o],R=c[q.url];n=new THREE.PerspectiveCamera(R.fov,R.aspect_ratio,R.znear,R.zfar)}n.name=e.name||e.id||"",n.matrix=e.matrix;var U=e.matrix.decompose();n.position=U[0],n.quaternion=U[1],n.useQuaternion=!0,n.scale=U[2];if(b.centerGeometry&&n.geometry){var z=THREE.GeometryUtils.center(n.geometry);z.multiply(n.scale),z.applyQuaternion(n.quaternion),n.position.sub(z)}for(o=0;o<e.nodes.length;o++)n.add(j(e.nodes[o],e));return n}function F(e,t){for(var n=0;n<e.joints.length;n++)if(e.joints[n]==t)return n}function I(t){return e.evaluate(".//dae:library_nodes//dae:node[@id='"+t+"']",e,Lt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext()}function q(e){var t=[],n=1e6,r=-1e6;for(var i in o){var s=o[i];for(var u=0;u<s.channel.length;u++){var a=s.channel[u],f=s.sampler[u],i=a.target.split("/")[0];i==e.id&&(f.create(),a.sampler=f,n=Math.min(n,f.startTime),r=Math.max(r,f.endTime),t.push(a))}}return t.length&&(e.startTime=n,e.endTime=r),t}function R(e){var t=1e7;for(var n=0;n<e.channels.length;n++){var r=e.channels[n].sampler;for(var i=0;i<r.input.length-1;i++){var s=r.input[i],o=r.input[i+1];t=Math.min(t,o-s)}}return t}function U(e,t){var n={},r,i;for(r=0;r<e.channels.length;r++){var s=e.channels[r];n[s.sid]=s}var o=new THREE.Matrix4;for(r=0;r<e.transforms.length;r++){var u=e.transforms[r],s=n[u.sid];if(s!==undefined){var a=s.sampler,f;for(i=0;i<a.input.length-1;i++)if(a.input[i+1]>t){f=a.output[i];break}f!==undefined?f instanceof THREE.Matrix4?o.multiplyMatrices(o,f):o.multiplyMatrices(o,u.matrix):o.multiplyMatrices(o,u.matrix)}else o.multiplyMatrices(o,u.matrix)}return o}function z(e){if(e.channels&&e.channels.length){var t=[],n=[];for(var r=0,i=e.channels.length;r<i;r++){var s=e.channels[r],o=s.fullSid,u=s.sampler,a=u.input,f=e.getTransformBySid(s.sid),l;if(s.arrIndices){l=[];for(var c=0,h=s.arrIndices.length;c<h;c++)l[c]=Wt(s.arrIndices[c])}else l=Xt(s.member);if(f){n.indexOf(o)===-1&&n.push(o);for(var c=0,h=a.length;c<h;c++){var p=a[c],d=u.getData(f.type,c),v=W(t,p);if(!v){v=new Tt(p);var m=X(t,p);t.splice(m==-1?t.length:m,0,v)}v.addTarget(o,f,l,d)}}else console.log('Could not find transform "'+s.sid+'" in node '+e.id)}for(var r=0;r<n.length;r++){var g=n[r];for(var c=0;c<t.length;c++){var v=t[c];v.hasTarget(g)||V(t,v,c,g)}}e.keys=t,e.sids=n}}function W(e,t){var n=null;for(var r=0,i=e.length;r<i&&n==null;r++){var s=e[r];if(s.time===t)n=s;else if(s.time>t)break}return n}function X(e,t){var n=-1;for(var r=0,i=e.length;r<i&&n==-1;r++){var s=e[r];s.time>=t&&(n=r)}return n}function V(e,t,n,r){var i=J(e,r,n?n-1:0),s=$(e,r,n+1);if(i&&s){var o=(t.time-i.time)/(s.time-i.time),u=i.getTarget(r),a=s.getTarget(r).data,f=u.data,l;if(u.type==="matrix")l=f;else if(f.length){l=[];for(var c=0;c<f.length;++c)l[c]=f[c]+(a[c]-f[c])*o}else l=f+(a-f)*o;t.addTarget(r,u.transform,u.member,l)}}function $(e,t,n){for(;n<e.length;n++){var r=e[n];if(r.hasTarget(t))return r}return null}function J(e,t,n){n=n>=0?n:n+e.length;for(;n>=0;n--){var r=e[n];if(r.hasTarget(t))return r}return null}function K(){this.id="",this.init_from=""}function Q(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function G(){this.method=null,this.source=null,this.targets=null,this.weights=null}function Y(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function Z(){this.id="",this.name="",this.nodes=[],this.scene=new THREE.Object3D}function et(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function tt(){this.sid="",this.type="",this.data=[],this.obj=null}function nt(){this.url="",this.skeleton=[],this.instance_material=[]}function rt(){this.symbol="",this.target=""}function it(){this.url="",this.instance_material=[]}function st(){this.id="",this.mesh=null}function ot(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function ut(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function at(){ut.call(this),this.vcount=[]}function ft(){ut.call(this),this.vcount=3}function lt(){this.source="",this.count=0,this.stride=0,this.params=[]}function ct(){this.input={}}function ht(){this.semantic="",this.offset=0,this.source="",this.set=0}function pt(e){this.id=e,this.type=null}function dt(){this.id="",this.name="",this.instance_effect=null}function vt(){this.color=new THREE.Color(0),this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function mt(e,t){this.type=e,this.effect=t,this.material=null}function gt(e){this.effect=e,this.init_from=null,this.format=null}function yt(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function bt(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function wt(){this.url=""}function Et(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function St(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function xt(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function Tt(e){this.targets=[],this.time=e}function Nt(){this.id="",this.name="",this.technique=""}function Ct(){this.url=""}function kt(e){var t=e.getAttribute("id");return i[t]!=undefined?i[t]:(i[t]=(new pt(t)).parse(e),i[t])}function Lt(e){return e=="dae"?"http://www.collada.org/2005/11/COLLADASchema":null}function At(e){var t=_t(e),n=[];for(var r=0,i=t.length;r<i;r++)n.push(t[r]=="true"||t[r]=="1"?!0:!1);return n}function Ot(e){var t=_t(e),n=[];for(var r=0,i=t.length;r<i;r++)n.push(parseFloat(t[r]));return n}function Mt(e){var t=_t(e),n=[];for(var r=0,i=t.length;r<i;r++)n.push(parseInt(t[r],10));return n}function _t(e){return e.length>0?Dt(e).split(/\s+/):[]}function Dt(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function Pt(e,t,n){return e.hasAttribute(t)?parseFloat(e.getAttribute(t)):n}function Ht(e,t,n){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):n}function Bt(e,t,n){return e.hasAttribute(t)?e.getAttribute(t):n}function jt(e,t){if(e===undefined){var n="0.";while(n.length<t+2)n+="0";return n}t=t||2;var r=e.toString().split(".");r[1]=r.length>1?r[1].substr(0,t):"0";while(r[1].length<t)r[1]+="0";return r.join(".")}function Ft(t,n){var r=e.evaluate(n,t,Lt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),i=r.iterateNext(),s=[];while(i)s.push(i),i=r.iterateNext();return s}function It(t,n){t.doubleSided=!1;var r=e.evaluate(".//dae:extra//dae:double_sided",n,Lt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);r&&(r=r.iterateNext(),r&&parseInt(r.textContent,10)===1&&(t.doubleSided=!0))}function qt(){if(!b.convertUpAxis||E===b.upAxis)S=null;else switch(E){case"X":S=b.upAxis==="Y"?"XtoY":"XtoZ";break;case"Y":S=b.upAxis==="X"?"YtoX":"YtoZ";break;case"Z":S=b.upAxis==="X"?"ZtoX":"ZtoY"}}function Rt(e,t){if(!b.convertUpAxis||E===b.upAxis)return;switch(S){case"XtoY":var n=e[0];e[0]=t*e[1],e[1]=n;break;case"XtoZ":var n=e[2];e[2]=e[1],e[1]=e[0],e[0]=n;break;case"YtoX":var n=e[0];e[0]=e[1],e[1]=t*n;break;case"YtoZ":var n=e[1];e[1]=t*e[2],e[2]=n;break;case"ZtoX":var n=e[0];e[0]=e[1],e[1]=e[2],e[2]=n;break;case"ZtoY":var n=e[1];e[1]=e[2],e[2]=t*n}}function Ut(e,t){var n=[e[t],e[t+1],e[t+2]];return Rt(n,-1),new THREE.Vector3(n[0],n[1],n[2])}function zt(e){if(b.convertUpAxis){var t=[e[0],e[4],e[8]];Rt(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],t=[e[1],e[5],e[9]],Rt(t,-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],t=[e[2],e[6],e[10]],Rt(t,-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],t=[e[0],e[1],e[2]],Rt(t,-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],t=[e[4],e[5],e[6]],Rt(t,-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],t=[e[8],e[9],e[10]],Rt(t,-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],t=[e[3],e[7],e[11]],Rt(t,-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return new THREE.Matrix4(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Wt(e){if(e>-1&&e<3){var t=["X","Y","Z"],n={X:0,Y:1,Z:2};e=Xt(t[e]),e=n[e]}return e}function Xt(e){if(b.convertUpAxis)switch(e){case"X":switch(S){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z"}break;case"Y":switch(S){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z"}break;case"Z":switch(S){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y"}}return e}var e=null,t=null,n,r=null,i={},s={},o={},u={},a={},f={},l={},c={},h,p,d,v,m,g=!0,y=THREE.SmoothShading,b={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},w=1,E="Y",S=null;return K.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];n.nodeName=="init_from"&&(this.init_from=n.textContent)}return this},Q.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];switch(n.nodeName){case"skin":this.skin=(new Y).parse(n),this.type=n.nodeName;break;case"morph":this.morph=(new G).parse(n),this.type=n.nodeName;break;default:}}return this},G.prototype.parse=function(e){var t={},n=[],r;this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,"");for(r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if(i.nodeType!=1)continue;switch(i.nodeName){case"source":var s=(new pt).parse(i);t[s.id]=s;break;case"targets":n=this.parseInputs(i);break;default:console.log(i.nodeName)}}for(r=0;r<n.length;r++){var o=n[r],s=t[o.source];switch(o.semantic){case"MORPH_TARGET":this.targets=s.read();break;case"MORPH_WEIGHT":this.weights=s.read();break;default:}}return this},G.prototype.parseInputs=function(e){var t=[];for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(r.nodeType!=1)continue;switch(r.nodeName){case"input":t.push((new ht).parse(r));break;default:}}return t},Y.prototype.parse=function(e){var t={},n,r;this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(s.nodeType!=1)continue;switch(s.nodeName){case"bind_shape_matrix":var o=Ot(s.textContent);this.bindShapeMatrix=zt(o);break;case"source":var u=(new pt).parse(s);t[u.id]=u;break;case"joints":n=s;break;case"vertex_weights":r=s;break;default:console.log(s.nodeName)}}return this.parseJoints(n,t),this.parseWeights(r,t),this},Y.prototype.parseJoints=function(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(r.nodeType!=1)continue;switch(r.nodeName){case"input":var i=(new ht).parse(r),s=t[i.source];i.semantic=="JOINT"?this.joints=s.read():i.semantic=="INV_BIND_MATRIX"&&(this.invBindMatrices=s.read());break;default:}}},Y.prototype.parseWeights=function(e,t){var n,r,i=[];for(var s=0;s<e.childNodes.length;s++){var o=e.childNodes[s];if(o.nodeType!=1)continue;switch(o.nodeName){case"input":i.push((new ht).parse(o));break;case"v":n=Mt(o.textContent);break;case"vcount":r=Mt(o.textContent);break;default:}}var u=0;for(var s=0;s<r.length;s++){var a=r[s],f=[];for(var l=0;l<a;l++){var c={};for(var h=0;h<i.length;h++){var p=i[h],d=n[u+p.offset];switch(p.semantic){case"JOINT":c.joint=d;break;case"WEIGHT":c.weight=t[p.source].data[d];break;default:}}f.push(c),u+=i.length}for(var l=0;l<f.length;l++)f[l].index=s;this.weights.push(f)}},Z.prototype.getChildById=function(e,t){for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildById(e,t);if(r)return r}return null},Z.prototype.getChildBySid=function(e,t){for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildBySid(e,t);if(r)return r}return null},Z.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType!=1)continue;switch(n.nodeName){case"node":this.nodes.push((new et).parse(n));break;default:}}return this},et.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var n=this.channels[t],r=n.target.split("/"),i=r.shift(),s=r.shift(),o=s.indexOf(".")>=0,u=s.indexOf("(")>=0,a,f;if(o)r=s.split("."),s=r.shift(),f=r.shift();else if(u){a=s.split("("),s=a.shift();for(var l=0;l<a.length;l++)a[l]=parseInt(a[l].replace(/\)/,""))}if(s==e)return n.info={sid:s,dotSyntax:o,arrSyntax:u,arrIndices:a},n}return null},et.prototype.getChildById=function(e,t){if(this.id==e)return this;if(t)for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildById(e,t);if(r)return r}return null},et.prototype.getChildBySid=function(e,t){if(this.sid==e)return this;if(t)for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildBySid(e,t);if(r)return r}return null},et.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid==e)return this.transforms[t];return null},et.prototype.parse=function(e){var t;this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.type=this.type=="JOINT"?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(r.nodeType!=1)continue;switch(r.nodeName){case"node":this.nodes.push((new et).parse(r));break;case"instance_camera":this.cameras.push((new Ct).parse(r));break;case"instance_controller":this.controllers.push((new nt).parse(r));break;case"instance_geometry":this.geometries.push((new it).parse(r));break;case"instance_light":break;case"instance_node":t=r.getAttribute("url").replace(/^#/,"");var i=I(t);i&&this.nodes.push((new et).parse(i));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new tt).parse(r));break;case"extra":break;default:console.log(r.nodeName)}}return this.channels=q(this),z(this),this.updateMatrix(),this},et.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},tt.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=Ot(e.textContent),this.convert(),this},tt.prototype.convert=function(){switch(this.type){case"matrix":this.obj=zt(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":Rt(this.data,-1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Rt(this.data,1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},tt.prototype.apply=function(e){switch(this.type){case"matrix":e.multiply(this.obj);break;case"translate":e.translate(this.obj);break;case"rotate":e.rotateByAxis(this.obj,this.angle);break;case"scale":e.scale(this.obj)}},tt.prototype.update=function(e,t){var n=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(!t)this.obj.copy(e);else if(t.length===1)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(t.length===2){var r="n"+(t[0]+1)+(t[1]+1);this.obj[r]=e}else console.log("Incorrect addressing of matrix in transform.");break;case"translate":case"scale":Object.prototype.toString.call(t)==="[object Array]"&&(t=n[t[0]]);switch(t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":Object.prototype.toString.call(t)==="[object Array]"&&(t=n[t[0]]);switch(t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=THREE.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=THREE.Math.degToRad(e[3])}}},nt.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(r.nodeType!==1)continue;switch(r.nodeName){case"skeleton":this.skeleton.push(r.textContent.replace(/^#/,""));break;case"bind_material":var i=e.evaluate(".//dae:instance_material",r,Lt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(i){var s=i.iterateNext();while(s)this.instance_material.push((new rt).parse(s)),s=i.iterateNext()}break;case"extra":break;default:}}return this},rt.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},it.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(r.nodeType!=1)continue;if(r.nodeName=="bind_material"){var i=e.evaluate(".//dae:instance_material",r,Lt,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(i){var s=i.iterateNext();while(s)this.instance_material.push((new rt).parse(s)),s=i.iterateNext()}break}}return this},st.prototype.parse=function(e){this.id=e.getAttribute("id"),It(this,e);for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];switch(n.nodeName){case"mesh":this.mesh=(new ot(this)).parse(n);break;case"extra":break;default:}}return this},ot.prototype.parse=function(e){this.primitives=[];var t,n;for(t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"source":kt(r);break;case"vertices":this.vertices=(new ct).parse(r);break;case"triangles":this.primitives.push((new ft).parse(r));break;case"polygons":this.primitives.push((new ut).parse(r));break;case"polylist":this.primitives.push((new at).parse(r));break;default:}}this.geometry3js=new THREE.Geometry;var s=i[this.vertices.input.POSITION.source].data;for(t=0;t<s.length;t+=3)this.geometry3js.vertices.push(Ut(s,t).clone());for(t=0;t<this.primitives.length;t++){var o=this.primitives[t];o.setVertices(this.vertices),this.handlePrimitive(o,this.geometry3js)}return this.geometry3js.computeCentroids(),this.geometry3js.computeFaceNormals(),this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this.geometry3js.computeBoundingBox(),this},ot.prototype.handlePrimitive=function(e,t){var n,r,s=e.p,o=e.inputs,u,a,f,l,c,h=0,p=3,d=0,v=[];for(n=0;n<o.length;n++){u=o[n];var m=u.offset+1;d=d<m?m:d;switch(u.semantic){case"TEXCOORD":v.push(u.set)}}for(var g=0;g<s.length;++g){var y=s[g],w=0;while(w<y.length){var E=[],S=[],x=null,T=[];e.vcount?p=e.vcount.length?e.vcount[h++]:e.vcount:p=y.length/d;for(n=0;n<p;n++)for(r=0;r<o.length;r++){u=o[r],l=i[u.source],a=y[w+n*d+u.offset],c=l.accessor.params.length,f=a*c;switch(u.semantic){case"VERTEX":E.push(a);break;case"NORMAL":S.push(Ut(l.data,f));break;case"TEXCOORD":x=x||{},x[u.set]===undefined&&(x[u.set]=[]),x[u.set].push(new THREE.Vector2(l.data[f],l.data[f+1]));break;case"COLOR":T.push((new THREE.Color).setRGB(l.data[f],l.data[f+1],l.data[f+2]));break;default:}}if(S.length==0){u=this.vertices.input.NORMAL;if(u){l=i[u.source],c=l.accessor.params.length;for(var N=0,C=E.length;N<C;N++)S.push(Ut(l.data,E[N]*c))}else t.calcNormals=!0}if(!x){x={},u=this.vertices.input.TEXCOORD;if(u){v.push(u.set),l=i[u.source],c=l.accessor.params.length;for(var N=0,C=E.length;N<C;N++)f=E[N]*c,x[u.set]===undefined&&(x[u.set]=[]),x[u.set].push(new THREE.Vector2(l.data[f],1-l.data[f+1]))}}if(T.length==0){u=this.vertices.input.COLOR;if(u){l=i[u.source],c=l.accessor.params.length;for(var N=0,C=E.length;N<C;N++)f=E[N]*c,T.push((new THREE.Color).setRGB(l.data[f],l.data[f+1],l.data[f+2]))}}var k=null,L=[],A,O;if(p===3)L.push(new THREE.Face3(E[0],E[1],E[2],S,T.length?T:new THREE.Color));else if(p===4)L.push(new THREE.Face4(E[0],E[1],E[2],E[3],S,T.length?T:new THREE.Color));else if(p>4&&b.subdivideFaces){var M=T.length?T:new THREE.Color,_,D,P,H,B,j;for(r=1;r<p-1;)L.push(new THREE.Face3(E[0],E[r],E[r+1],[S[0],S[r++],S[r]],M))}if(L.length)for(var N=0,C=L.length;N<C;N++){k=L[N],k.daeMaterial=e.material,t.faces.push(k);for(r=0;r<v.length;r++)A=x[v[r]],p>4?O=[A[0],A[N+1],A[N+2]]:p===4?O=[A[0],A[1],A[2],A[3]]:O=[A[0],A[1],A[2]],t.faceVertexUvs[r]||(t.faceVertexUvs[r]=[]),t.faceVertexUvs[r].push(O)}else console.log("dropped face with vcount "+p+" for geometry with id: "+t.id);w+=d*p}}},ut.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source==e.id&&(this.inputs[t].source=e.input.POSITION.source)},ut.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=Ht(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];switch(n.nodeName){case"input":this.inputs.push((new ht).parse(e.childNodes[t]));break;case"vcount":this.vcount=Mt(n.textContent);break;case"p":this.p.push(Mt(n.textContent));break;case"ph":console.warn("polygon holes not yet supported!");break;default:}}return this},at.prototype=Object.create(ut.prototype),ft.prototype=Object.create(ut.prototype),lt.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=Ht(e,"count",0),this.stride=Ht(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeName=="param"){var r={};r.name=n.getAttribute("name"),r.type=n.getAttribute("type"),this.params.push(r)}}return this},ct.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if(e.childNodes[t].nodeName=="input"){var n=(new ht).parse(e.childNodes[t]);this.input[n.semantic]=n}return this},ht.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=Ht(e,"set",-1),this.offset=Ht(e,"offset",0),this.semantic=="TEXCOORD"&&this.set<0&&(this.set=0),this},pt.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];switch(n.nodeName){case"bool_array":this.data=At(n.textContent),this.type=n.nodeName;break;case"float_array":this.data=Ot(n.textContent),this.type=n.nodeName;break;case"int_array":this.data=Mt(n.textContent),this.type=n.nodeName;break;case"IDREF_array":case"Name_array":this.data=_t(n.textContent),this.type=n.nodeName;break;case"technique_common":for(var r=0;r<n.childNodes.length;r++)if(n.childNodes[r].nodeName=="accessor"){this.accessor=(new lt).parse(n.childNodes[r]);break}break;default:}}return this},pt.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var n=0;n<this.data.length;n+=16){var r=this.data.slice(n,n+16),i=zt(r);e.push(i)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},dt.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if(e.childNodes[t].nodeName=="instance_effect"){this.instance_effect=(new wt).parse(e.childNodes[t]);break}return this},vt.prototype.isColor=function(){return this.texture==null},vt.prototype.isTexture=function(){return this.texture!=null},vt.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType!=1)continue;switch(n.nodeName){case"color":var r=Ot(n.textContent);this.color=new THREE.Color(0),this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=n.getAttribute("texture"),this.texcoord=n.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(n);break;default:}}return this},vt.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&e.childNodes[1].nodeName==="extra"&&(e=e.childNodes[1],e.childNodes[1]&&e.childNodes[1].nodeName==="technique"&&(e=e.childNodes[1]));for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];switch(n.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":this.texOpts[n.nodeName]=parseInt(n.textContent);break;default:this.texOpts[n.nodeName]=n.textContent}}return this},mt.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType!=1)continue;switch(n.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[n.nodeName]=(new vt).parse(n);break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var r=Ft(n,".//dae:float");r.length>0&&(this[n.nodeName]=parseFloat(r[0].textContent));break;default:}}return this.create(),this},mt.prototype.create=function(){var e={},t=this.transparency!==undefined&&this.transparency<1;for(var n in this)switch(n){case"ambient":case"emission":case"diffuse":case"specular":var r=this[n];if(r instanceof vt)if(r.isTexture()){var i=r.texture,o=this.effect.sampler[i].source;if(o){var u=this.effect.surface[o],a=s[u.init_from];if(a){var f=THREE.ImageUtils.loadTexture(d+a.init_from);f.wrapS=r.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,f.wrapT=r.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,f.offset.x=r.texOpts.offsetU,f.offset.y=r.texOpts.offsetV,f.repeat.x=r.texOpts.repeatU,f.repeat.y=r.texOpts.repeatV,e.map=f,n==="emission"&&(e.emissive=16777215)}}}else if(n==="diffuse"||!t)n==="emission"?e.emissive=r.color.getHex():e[n]=r.color.getHex();break;case"shininess":e[n]=this[n];break;case"reflectivity":e[n]=this[n],e[n]>0&&(e.envMap=b.defaultEnvMap),e.combine=THREE.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[n],this[n]!==1&&(e.envMap=b.defaultEnvMap);break;case"transparency":t&&(e.transparent=!0,e.opacity=this[n],t=!0);break;default:}e.shading=y,e.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide;switch(this.type){case"constant":e.emissive!=undefined&&(e.color=e.emissive),this.material=new THREE.MeshBasicMaterial(e);break;case"phong":case"blinn":e.diffuse!=undefined&&(e.color=e.diffuse),this.material=new THREE.MeshPhongMaterial(e);break;case"lambert":default:e.diffuse!=undefined&&(e.color=e.diffuse),this.material=new THREE.MeshLambertMaterial(e)}return this.material},gt.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType!=1)continue;switch(n.nodeName){case"init_from":this.init_from=n.textContent;break;case"format":this.format=n.textContent;break;default:console.log("unhandled Surface prop: "+n.nodeName)}}return this},yt.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType!=1)continue;switch(n.nodeName){case"source":this.source=n.textContent;break;case"minfilter":this.minfilter=n.textContent;break;case"magfilter":this.magfilter=n.textContent;break;case"mipfilter":this.mipfilter=n.textContent;break;case"wrap_s":this.wrap_s=n.textContent;break;case"wrap_t":this.wrap_t=n.textContent;break;default:console.log("unhandled Sampler2D prop: "+n.nodeName)}}return this},bt.prototype.create=function(){if(this.shader==null)return null},bt.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),It(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType!=1)continue;switch(n.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(n));break;default:}}return this},bt.prototype.parseNewparam=function(e){var t=e.getAttribute("sid");for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(r.nodeType!=1)continue;switch(r.nodeName){case"surface":this.surface[t]=(new gt(this)).parse(r);break;case"sampler2D":this.sampler[t]=(new yt(this)).parse(r);break;case"extra":break;default:console.log(r.nodeName)}}},bt.prototype.parseProfileCOMMON=function(e){var t;for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(r.nodeType!=1)continue;switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":t=r;break;case"newparam":this.parseNewparam(r);break;case"image":var i=(new K).parse(r);s[i.id]=i;break;case"extra":break;default:console.log(r.nodeName)}}return t},bt.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType!=1)continue;switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=(new mt(n.nodeName,this)).parse(n);break;default:}}},wt.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},Et.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType!=1)continue;switch(n.nodeName){case"animation":var r=(new Et).parse(n);for(var i in r.source)this.source[i]=r.source[i];for(var s=0;s<r.channel.length;s++)this.channel.push(r.channel[s]),this.sampler.push(r.sampler[s]);break;case"source":var i=(new pt).parse(n);this.source[i.id]=i;break;case"sampler":this.sampler.push((new xt(this)).parse(n));break;case"channel":this.channel.push((new St(this)).parse(n));break;default:}}return this},St.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/"),n=t.shift(),r=t.shift(),i=r.indexOf(".")>=0,s=r.indexOf("(")>=0;if(i)t=r.split("."),this.sid=t.shift(),this.member=t.shift();else if(s){var o=r.split("(");this.sid=o.shift();for(var u=0;u<o.length;u++)o[u]=parseInt(o[u].replace(/\)/,""));this.arrIndices=o}else this.sid=r;return this.fullSid=r,this.dotSyntax=i,this.arrSyntax=s,this},xt.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType!=1)continue;switch(n.nodeName){case"input":this.inputs.push((new ht).parse(n));break;default:}}return this},xt.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],n=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=n.read();break;case"OUTPUT":this.output=n.read(),this.strideOut=n.accessor.stride;break;case"INTERPOLATION":this.interpolation=n.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(t.semantic)}}this.startTime=0,this.endTime=0,this.duration=0;if(this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},xt.prototype.getData=function(e,t){var n;if(e==="matrix"&&this.strideOut===16)n=this.output[t];else if(this.strideOut>1){n=[],t*=this.strideOut;for(var r=0;r<this.strideOut;++r)n[r]=this.output[t+r];if(this.strideOut===3)switch(e){case"rotate":case"translate":Rt(n,-1);break;case"scale":Rt(n,1)}else this.strideOut===4&&e==="matrix"&&Rt(n,-1)}else n=this.output[t];return n},Tt.prototype.addTarget=function(e,t,n,r){this.targets.push({sid:e,member:n,transform:t,data:r})},Tt.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var n=this.targets[t];(!e||n.sid===e)&&n.transform.update(n.data,n.member)}},Tt.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},Tt.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},Tt.prototype.interpolate=function(e,t){for(var n=0;n<this.targets.length;++n){var r=this.targets[n],i=e.getTarget(r.sid),s;if(r.transform.type!=="matrix"&&i){var o=(t-this.time)/(e.time-this.time),u=i.data,a=r.data;if(o<0||o>1)console.log("Key.interpolate: Warning! Scale out of bounds:"+o),o=o<0?0:1;if(a.length){s=[];for(var f=0;f<a.length;++f)s[f]=a[f]+(u[f]-a[f])*o}else s=a+(u-a)*o}else s=r.data;r.transform.update(s,r.member)}},Nt.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType!=1)continue;switch(n.nodeName){case"optics":this.parseOptics(n);break;default:}}return this},Nt.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if(e.childNodes[t].nodeName=="technique_common"){var n=e.childNodes[t];for(var r=0;r<n.childNodes.length;r++){this.technique=n.childNodes[r].nodeName;if(this.technique=="perspective"){var i=n.childNodes[r];for(var s=0;s<i.childNodes.length;s++){var o=i.childNodes[s];switch(o.nodeName){case"yfov":this.yfov=o.textContent;break;case"xfov":this.xfov=o.textContent;break;case"znear":this.znear=o.textContent;break;case"zfar":this.zfar=o.textContent;break;case"aspect_ratio":this.aspect_ratio=o.textContent}}}else if(this.technique=="orthographic"){var u=n.childNodes[r];for(var s=0;s<u.childNodes.length;s++){var o=u.childNodes[s];switch(o.nodeName){case"xmag":this.xmag=o.textContent;break;case"ymag":this.ymag=o.textContent;break;case"znear":this.znear=o.textContent;break;case"zfar":this.zfar=o.textContent;break;case"aspect_ratio":this.aspect_ratio=o.textContent}}}}}return this},Ct.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},{load:x,parse:T,setPreferredShading:N,applySkin:B,geometries:a,options:b}};