THREE.TrackballControls=function(e,t){function v(e){if(!n.enabled)return;window.removeEventListener("keydown",v),o=s;if(s!==r.NONE)return;e.keyCode===n.keys[r.ROTATE]&&!n.noRotate?s=r.ROTATE:e.keyCode===n.keys[r.ZOOM]&&!n.noZoom?s=r.ZOOM:e.keyCode===n.keys[r.PAN]&&!n.noPan&&(s=r.PAN)}function m(e){if(!n.enabled)return;s=o,window.addEventListener("keydown",v,!1)}function g(e){if(!n.enabled)return;e.preventDefault(),e.stopPropagation(),s===r.NONE&&(s=e.button),s===r.ROTATE&&!n.noRotate?a=f=n.getMouseProjectionOnBall(e.clientX,e.clientY):s===r.ZOOM&&!n.noZoom?l=c=n.getMouseOnScreen(e.clientX,e.clientY):s===r.PAN&&!n.noPan&&(h=p=n.getMouseOnScreen(e.clientX,e.clientY)),document.addEventListener("mousemove",y,!1),document.addEventListener("mouseup",b,!1)}function y(e){if(!n.enabled)return;s===r.ROTATE&&!n.noRotate?f=n.getMouseProjectionOnBall(e.clientX,e.clientY):s===r.ZOOM&&!n.noZoom?c=n.getMouseOnScreen(e.clientX,e.clientY):s===r.PAN&&!n.noPan&&(p=n.getMouseOnScreen(e.clientX,e.clientY))}function b(e){if(!n.enabled)return;e.preventDefault(),e.stopPropagation(),s=r.NONE,document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",b)}function w(e){if(!n.enabled)return;e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),l.y+=1/t*.05}function E(e){if(!n.enabled)return;e.preventDefault();switch(e.touches.length){case 1:a=f=n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:l=c=n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;case 3:h=p=n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)}}function S(e){if(!n.enabled)return;e.preventDefault();switch(e.touches.length){case 1:f=n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:c=n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;case 3:p=n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)}}THREE.EventDispatcher.call(this);var n=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=e,this.domElement=t!==undefined?t:document,this.enabled=!0,this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=Infinity,this.keys=[65,83,68],this.target=new THREE.Vector3;var i=new THREE.Vector3,s=r.NONE,o=r.NONE,u=new THREE.Vector3,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector2,c=new THREE.Vector2,h=new THREE.Vector2,p=new THREE.Vector2,d={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleEvent=function(e){typeof this[e.type]=="function"&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-n.screen.offsetLeft)/n.radius*.5,(t-n.screen.offsetTop)/n.radius*.5)},this.getMouseProjectionOnBall=function(e,t){var r=new THREE.Vector3((e-n.screen.width*.5-n.screen.offsetLeft)/n.radius,(n.screen.height*.5+n.screen.offsetTop-t)/n.radius,0),i=r.length();i>1?r.normalize():r.z=Math.sqrt(1-i*i),u.copy(n.object.position).subSelf(n.target);var s=n.object.up.clone().setLength(r.y);return s.addSelf(n.object.up.clone().crossSelf(u).setLength(r.x)),s.addSelf(u.setLength(r.z)),s},this.rotateCamera=function(){var e=Math.acos(a.dot(f)/a.length()/f.length());if(e){var t=(new THREE.Vector3).cross(a,f).normalize(),r=new THREE.Quaternion;e*=n.rotateSpeed,r.setFromAxisAngle(t,-e),r.multiplyVector3(u),r.multiplyVector3(n.object.up),r.multiplyVector3(f),n.staticMoving?a.copy(f):(r.setFromAxisAngle(t,e*(n.dynamicDampingFactor-1)),r.multiplyVector3(a))}},this.zoomCamera=function(){var e=1+(c.y-l.y)*n.zoomSpeed;e!==1&&e>0&&(u.multiplyScalar(e),n.staticMoving?l.copy(c):l.y+=(c.y-l.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=p.clone().subSelf(h);if(e.lengthSq()){e.multiplyScalar(u.length()*n.panSpeed);var t=u.clone().crossSelf(n.object.up).setLength(e.x);t.addSelf(n.object.up.clone().setLength(e.y)),n.object.position.addSelf(t),n.target.addSelf(t),n.staticMoving?h=p:h.addSelf(e.sub(p,h).multiplyScalar(n.dynamicDampingFactor))}},this.checkDistances=function(){if(!n.noZoom||!n.noPan)n.object.position.lengthSq()>n.maxDistance*n.maxDistance&&n.object.position.setLength(n.maxDistance),u.lengthSq()<n.minDistance*n.minDistance&&n.object.position.add(n.target,u.setLength(n.minDistance))},this.update=function(){u.copy(n.object.position).subSelf(n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.add(n.target,u),n.checkDistances(),n.object.lookAt(n.target),i.distanceToSquared(n.object.position)>0&&(n.dispatchEvent(d),i.copy(n.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",g,!1),this.domElement.addEventListener("mousewheel",w,!1),this.domElement.addEventListener("DOMMouseScroll",w,!1),this.domElement.addEventListener("touchstart",E,!1),this.domElement.addEventListener("touchend",E,!1),this.domElement.addEventListener("touchmove",S,!1),window.addEventListener("keydown",v,!1),window.addEventListener("keyup",m,!1),this.handleResize()};